(()=>{"use strict";function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var e=function(){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this._token=t.token,this._cohortId=t.cohortId}var n,r;return n=e,(r=[{key:"getInitialCards",value:function(){return fetch("https://mesto.nomoreparties.co/v1/".concat(this._cohortId,"/cards"),{method:"GET",headers:{authorization:"".concat(this._token)}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){console.log(t)}))}},{key:"sendNewCard",value:function(t){return fetch("https://mesto.nomoreparties.co/v1/".concat(this._cohortId,"/cards"),{method:"POST",headers:{authorization:"".concat(this._token),"Content-Type":"application/json"},body:JSON.stringify({name:"".concat(t.name),link:"".concat(t.link)})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){console.log(t)}))}},{key:"deleteCard",value:function(t){return fetch("https://mesto.nomoreparties.co/v1/".concat(this._cohortId,"/cards/").concat(t),{method:"DELETE",headers:{authorization:"".concat(this._token)}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){console.log(t)}))}},{key:"getProfile",value:function(){return fetch("https://mesto.nomoreparties.co/v1/".concat(this._cohortId,"/users/me"),{method:"GET",headers:{authorization:"".concat(this._token)}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){console.log(t)}))}},{key:"setProfile",value:function(t){return fetch("https://mesto.nomoreparties.co/v1/".concat(this._cohortId,"/users/me"),{method:"PATCH",headers:{authorization:"".concat(this._token),"Content-Type":"application/json"},body:JSON.stringify({name:"".concat(t.name),about:"".concat(t.description)})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){console.log(t)}))}},{key:"setAvatar",value:function(t){return fetch("https://mesto.nomoreparties.co/v1/".concat(this._cohortId,"/users/me/avatar"),{method:"PATCH",headers:{authorization:"".concat(this._token),"Content-Type":"application/json"},body:JSON.stringify({avatar:"".concat(t)})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){console.log(t)}))}},{key:"setLike",value:function(t){return fetch("https://mesto.nomoreparties.co/v1/".concat(this._cohortId,"/cards/").concat(t,"/likes"),{method:"PUT",headers:{authorization:"".concat(this._token)}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){console.log(t)}))}},{key:"deleteLike",value:function(t){return fetch("https://mesto.nomoreparties.co/v1/".concat(this._cohortId,"/cards/").concat(t,"/likes"),{method:"DELETE",headers:{authorization:"".concat(this._token)}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){console.log(t)}))}}])&&t(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),e}();function n(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var r=function(){function t(e,n){var r,o,i=this,c=e.data,a=e.handleCardClick,u=e.isCreator,s=e.currentUserId,l=e.handleDeleteCardClick,f=e.handleLikeClick;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),o=function(){i._card.remove()},(r="removeCard")in this?Object.defineProperty(this,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):this[r]=o,this._data=c,this._name=c.name,this._link=c.link,this._isCreator=u,this._currentUserId=s,this._cardSelector=n,this._handleCardClick=a,this._handleDeleteCardClick=l,this._handleLikeClick=f}var e,r;return e=t,(r=[{key:"_getTemplate",value:function(){return document.querySelector(this._cardSelector).content.querySelector(".card").cloneNode(!0)}},{key:"_setEventListeners",value:function(){var t=this;this._card.querySelector(".card__img").addEventListener("click",(function(){t._handleCardClick(t._name,t._link)})),this._card.querySelector(".card__like").addEventListener("click",(function(){t._handleLikeClick(t._card,t._data)})),this._card.querySelector(".card__delete").addEventListener("click",(function(){t._handleDeleteCardClick(t._data._id)}))}},{key:"createCard",value:function(){var t=this;return this._card=this._getTemplate(),this._like=this._card.querySelector(".card__like"),this._likeCounter=this._card.querySelector(".card__like-counter"),this._imgCard=this._card.querySelector(".card__img"),this._trashCard=this._card.querySelector(".card__delete"),this._isCreator&&this._trashCard.classList.add("card__delete_visible"),this._data.likes.forEach((function(e){e._id===t._currentUserId&&t._like.classList.add("card__like_active")})),this._likeCounter.textContent=this._data.likes.length,this._imgCard.alt=this._name,this._imgCard.src=this._link,this._card.querySelector(".card__name").textContent=this._name,this._setEventListeners(),this._card}}])&&n(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function o(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var i=function(){function t(e,n){var r=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),function(t,e,n){e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n}(this,"_showInputError",(function(t,e){r._errorElement=r._formElement.querySelector(".".concat(t.id,"-error")),r._buttonSave=r._formElement.querySelector(r._submitButtonSelector),r._buttonSave.classList.add(r._inactiveButtonClass),t.classList.add(r._inputErrorClass),r._errorElement.textContent=e,r._errorElement.classList.add(r._errorClass)})),this._popup=n,this._formSelector=e.formSelector,this._inputSelector=e.inputSelector,this._submitButtonSelector=e.submitButtonSelector,this._inactiveButtonClass=e.inactiveButtonClass,this._inputErrorClass=e.inputErrorClass,this._errorClass=e.errorClass}var e,n;return e=t,(n=[{key:"_hideInputError",value:function(t){this._errorElement=this._formElement.querySelector(".".concat(t.id,"-error")),t.classList.remove(this._inputErrorClass),this._errorElement.textContent="",this._errorElement.classList.remove(this._errorClass)}},{key:"_hasInvalidInput",value:function(){return this._inputItemsList.some((function(t){return!t.validity.valid}))}},{key:"_changeButtonState",value:function(){this._hasInvalidInput(this._inputItemsList)?(this._buttonSave.classList.add(this._inactiveButtonClass),this._buttonSave.disabled=!0):(this._buttonSave.classList.remove(this._inactiveButtonClass),this._buttonSave.disabled=!1)}},{key:"_isValid",value:function(t){t.validity.valid?this._hideInputError(t):this._showInputError(t,t.validationMessage)}},{key:"_handleInputChange",value:function(){var t=this;this._inputItemsList=Array.from(this._formElement.querySelectorAll(this._inputSelector)),this._buttonSave=this._formElement.querySelector(this._submitButtonSelector),this._inputItemsList.forEach((function(e){e.addEventListener("input",(function(n){n.preventDefault(),t._isValid(e),t._changeButtonState()}))}))}},{key:"_handleSubmitForm",value:function(){this._formElement=this._popup.querySelector(this._formSelector),this._formElement.addEventListener("submit",(function(t){t.preventDefault()}))}},{key:"_setEventListeners",value:function(){this._handleSubmitForm(),this._handleInputChange()}},{key:"enableValidation",value:function(){this._setEventListeners(),this._changeButtonState()}},{key:"resetValidation",value:function(){var t=this;this._changeButtonState(),this._inputItemsList.forEach((function(e){t._hideInputError(e)}))}}])&&o(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}(),c={formSelector:".form",inputSelector:".form__item",submitButtonSelector:".form__save-button",inactiveButtonClass:"form__save-button_disabled",inputErrorClass:"form__item_type_error",errorClass:"form__item-error_active"};function a(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var u=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._container=document.querySelector(e)}var e,n;return e=t,(n=[{key:"addItem",value:function(t){this._container.prepend(t)}}])&&a(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function s(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function l(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var f=function(){function t(e){var n=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),l(this,"_clickHandler",(function(t){t.target.classList.contains("pop-up_opened")&&n.close()})),l(this,"_handleEscClose",(function(t){n._popup.classList.contains("pop-up_opened")&&"Escape"===t.key&&n.close()})),this._popup=document.querySelector(e),this._closeButton=this._popup.querySelector(".pop-up__close-button")}var e,n;return e=t,(n=[{key:"open",value:function(){this._popup.classList.add("pop-up_opened"),document.addEventListener("keydown",this._handleEscClose)}},{key:"close",value:function(){this._popup.classList.remove("pop-up_opened"),document.removeEventListener("keydown",this._handleEscClose)}},{key:"setEventListeners",value:function(){var t=this;this._closeButton.addEventListener("click",(function(){t.close()})),this._popup.addEventListener("click",this._clickHandler)}}])&&s(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function p(t){return p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},p(t)}function h(t,e){return h=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},h(t,e)}function d(t,e){if(e&&("object"===p(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return _(t)}function _(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function y(){return y="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=m(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},y.apply(this,arguments)}function m(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=v(t)););return t}function v(t){return v=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},v(t)}function b(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var k=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&h(t,e)}(i,t);var e,n,r,o=(n=i,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=v(n);if(r){var o=v(this).constructor;t=Reflect.construct(e,arguments,o)}else t=e.apply(this,arguments);return d(this,t)});function i(t,e){var n,r,c;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),b(_(c=o.call(this,t)),"open",(function(t){c._cardId=t,y((n=_(c),v(i.prototype)),"open",n).call(n)})),b(_(c),"setEventListeners",(function(){c._form.addEventListener("submit",(function(t){t.preventDefault(),c._handleFormSubmit(c._cardId)})),y((r=_(c),v(i.prototype)),"setEventListeners",r).call(r)})),c._form=c._popup.querySelector(".form"),c._handleFormSubmit=e,c}return e=i,Object.defineProperty(e,"prototype",{writable:!1}),e}(f);function g(t){return g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},g(t)}function S(t,e){return S=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},S(t,e)}function w(t,e){if(e&&("object"===g(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return C(t)}function C(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function E(){return E="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=j(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},E.apply(this,arguments)}function j(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=O(t)););return t}function O(t){return O=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},O(t)}var P=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&S(t,e)}(i,t);var e,n,r,o=(n=i,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=O(n);if(r){var o=O(this).constructor;t=Reflect.construct(e,arguments,o)}else t=e.apply(this,arguments);return w(this,t)});function i(t){var e,n,r,c,a;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),a=function(t,r){n._popupImage.src=r,n._popupImage.alt=t,n._popupImageLabel.textContent=t,E((e=C(n),O(i.prototype)),"open",e).call(e)},(c="open")in(r=C(n=o.call(this,t)))?Object.defineProperty(r,c,{value:a,enumerable:!0,configurable:!0,writable:!0}):r.open=a,n._popupImage=n._popup.querySelector(".pop-up__image"),n._popupImageLabel=n._popup.querySelector(".pop-up__label"),n}return e=i,Object.defineProperty(e,"prototype",{writable:!1}),e}(f);function L(t){return L="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},L(t)}function I(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function q(t,e){return q=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},q(t,e)}function T(t,e){if(e&&("object"===L(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return R(t)}function R(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function B(){return B="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=x(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}},B.apply(this,arguments)}function x(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=D(t)););return t}function D(t){return D=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},D(t)}function V(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var A=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&q(t,e)}(c,t);var e,n,r,o,i=(r=c,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=D(r);if(o){var n=D(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return T(this,t)});function c(t,e){var n,r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,c),V(R(r=i.call(this,t)),"_getInputValues",(function(){var t={};return r._inputList.forEach((function(e){t[e.name]=e.value})),t})),V(R(r),"setInputValues",(function(t){r._inputList.forEach((function(e){e.value=t[e.name]}))})),V(R(r),"setEventListeners",(function(){r._form.addEventListener("submit",(function(t){t.preventDefault(),r._handleFormSubmit(r._getInputValues())})),B((n=R(r),D(c.prototype)),"setEventListeners",n).call(n)})),r._handleFormSubmit=e,r._form=r._popup.querySelector(".form"),r._inputList=r._form.querySelectorAll(".form__item"),r}return e=c,(n=[{key:"close",value:function(){this._form.reset(),B(D(c.prototype),"close",this).call(this)}}])&&I(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),c}(f);function U(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function N(t,e,n){return e&&U(t.prototype,e),n&&U(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function z(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var F=N((function t(e,n,r){var o=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),z(this,"getUserInfo",(function(){return{name:o._fieldName.textContent,description:o._fieldDescriptions.textContent}})),z(this,"setUserInfo",(function(t){o._fieldName.textContent=t.name,o._fieldDescriptions.textContent=t.about})),z(this,"setAvatar",(function(t){o._avatar.src=t})),this._fieldName=document.querySelector(e),this._fieldDescriptions=document.querySelector(n),this._avatar=document.querySelector(r)})),H=document.querySelector(".profile__info"),J=document.querySelector(".profile__avatar"),G=H.querySelector(".profile__edit-button"),M=document.querySelector(".profile__add-button"),K=(document.querySelector(".galary"),document.querySelector("#profileEditPopup")),Q=document.querySelector("#cardAddPopup"),W=document.querySelector("#avatarUpdatePopup"),X="",Y=new u(".galary__cards-list"),Z=new i(c,K),$=new i(c,Q),tt=new i(c,W),et=new F(".profile__name",".profile__description",".profile__avatar"),nt=function(t){var e=t.querySelector(".form__save-button");"Сохранить"===e.textContent?e.textContent="Сохранение...":e.textContent="Сохранить"},rt=new e({token:"eb3b2bc4-a18d-46ae-aeed-207ad13f265c",cohortId:"cohort-41"});rt.getInitialCards().then((function(t){t.forEach((function(t){Y.addItem(ot(t))}))})),rt.getProfile().then((function(t){et.setUserInfo(t),et.setAvatar(t.avatar),X=t._id}));var ot=function(t){return new r({data:t,handleCardClick:function(t,e){at.open(t,e)},isCreator:X==t.owner._id,currentUserId:X,handleDeleteCardClick:function(t){st.open(t)},handleLikeClick:function(t,e){var n=t.querySelector(".card__like"),r=t.querySelector(".card__like-counter");n.classList.contains("card__like_active")?(n.classList.remove("card__like_active"),rt.deleteLike(e._id).then((function(t){r.textContent=t.likes.length}))):(n.classList.add("card__like_active"),rt.setLike(e._id).then((function(t){r.textContent=t.likes.length})))}},"#card").createCard()},it=new A("#profileEditPopup",(function(t){rt.setProfile(t).then((function(t){return nt(K),t})).then((function(t){et.setUserInfo(t)})).then((function(){it.close(),nt(K)}))}));it.setEventListeners();var ct=new A("#avatarUpdatePopup",(function(t){rt.setAvatar(t.link).then((function(t){return nt(W),t})).then((function(t){et.setAvatar(t.link)})).then((function(){ct.close(),nt(W)}))}));ct.setEventListeners();var at=new P("#imagePopup");at.setEventListeners();var ut=new A("#cardAddPopup",(function(t){rt.sendNewCard(t).then((function(t){return nt(Q),t})).then((function(t){Y.addItem(ot(t))})).then((function(){ut.close(),nt(Q)}))}));ut.setEventListeners();var st=new k("#cardConfirmDeletePopup",(function(t){console.log(t),rt.deleteCard(t).then((function(t){"Пост удалён"==t.message&&st.close()}))}));st.setEventListeners(),M.addEventListener("click",(function(){ut.open(),$.resetValidation()})),G.addEventListener("click",(function(){it.open(),it.setInputValues(et.getUserInfo()),Z.resetValidation()})),J.addEventListener("click",(function(){ct.open(),tt.resetValidation()})),Z.enableValidation(),$.enableValidation(),tt.enableValidation()})();